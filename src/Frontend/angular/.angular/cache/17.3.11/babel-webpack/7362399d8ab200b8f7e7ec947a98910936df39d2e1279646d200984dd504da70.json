{"ast":null,"code":"import { UrlTree } from '@angular/router';\nimport { lastValueFrom, of } from 'rxjs';\nimport { mergeMap, take } from 'rxjs/operators';\nimport { wrapIntoObservable } from '../utils';\nimport { JssCanActivateRedirectError } from './jss-can-activate-error';\n/**\n * @param {boolean | string | string[] | UrlTree} value\n * @returns instance of value\n */\nfunction isRedirectValue(value) {\n  return value instanceof UrlTree || typeof value === 'string' || Array.isArray(value);\n}\n/**\n * Resolves components based on provided guards\n * @param {Injector} injector\n * @param {ActivatedRoute} activatedRoute\n * @param {Router} router\n * @returns {(factories: ComponentFactoryResult[]) => Promise<ComponentFactoryResult[]>} factory\n */\nexport function guardResolverFactory(injector, activatedRoute, router) {\n  /**\n   * @param {JssCanActivate | Type<JssCanActivate> | JssCanActivateFn} guard\n   * @returns resolved guard\n   */\n  function getGuardInstance(guard) {\n    if ('canActivate' in guard) {\n      return guard;\n    }\n    try {\n      // Class is provided\n      return injector.get(guard);\n    } catch {\n      // Function is provided\n      return guard;\n    }\n  }\n  /**\n   * @param {ComponentFactoryResult} factory\n   * @returns {(JssCanActivate | JssCanActivateFn)[]} guard instances\n   */\n  function collectGuardInstances(factory) {\n    if (factory.canActivate) {\n      return Array.isArray(factory.canActivate) ? factory.canActivate.map(getGuardInstance) : [getGuardInstance(factory.canActivate)];\n    }\n    return [];\n  }\n  /**\n   *\n   * @param {JssCanActivate | JssCanActivateFn} guard\n   * @param {ComponentFactoryResult} factory\n   * @returns canActivate\n   */\n  function resolveGuard(guard, factory) {\n    const canActivate = 'canActivate' in guard ? guard.canActivate.bind(guard) : guard;\n    const guardValue = canActivate({\n      activatedRoute: activatedRoute.snapshot,\n      routerState: router.routerState.snapshot,\n      rendering: factory.componentDefinition\n    });\n    const canActivate$ = wrapIntoObservable(guardValue);\n    return lastValueFrom(canActivate$.pipe(take(1), mergeMap(value => {\n      if (isRedirectValue(value)) {\n        throw new JssCanActivateRedirectError(`Value: '${value.toString()}' is a redirect value`, value);\n      } else {\n        return of(value);\n      }\n    })));\n  }\n  return function resolveGuards(factories) {\n    const resolved = factories.map(factory => {\n      const guards = collectGuardInstances(factory);\n      const pending = guards.map(guard => resolveGuard(guard, factory));\n      return Promise.all(pending).then(canActive => canActive.every(v => v)).then(canActivate => ({\n        factory,\n        canActivate\n      }));\n    });\n    return Promise.all(resolved).then(mapped => mapped.filter(m => m.canActivate).map(m => m.factory));\n  };\n}\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ3VhcmQtcmVzb2x2ZXItZmFjdG9yeS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9zZXJ2aWNlcy9ndWFyZC1yZXNvbHZlci1mYWN0b3J5LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUNBLE9BQU8sRUFBMEIsT0FBTyxFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFFbEUsT0FBTyxFQUFFLGFBQWEsRUFBRSxFQUFFLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDekMsT0FBTyxFQUFFLFFBQVEsRUFBRSxJQUFJLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUVoRCxPQUFPLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSxVQUFVLENBQUM7QUFDOUMsT0FBTyxFQUFFLDJCQUEyQixFQUFFLE1BQU0sMEJBQTBCLENBQUM7QUFHdkU7OztHQUdHO0FBQ0gsU0FBUyxlQUFlLENBQ3RCLEtBQTRDO0lBRTVDLE9BQU8sS0FBSyxZQUFZLE9BQU8sSUFBSSxPQUFPLEtBQUssS0FBSyxRQUFRLElBQUksS0FBSyxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQztBQUN2RixDQUFDO0FBRUQ7Ozs7OztHQU1HO0FBQ0gsTUFBTSxVQUFVLG9CQUFvQixDQUNsQyxRQUFrQixFQUNsQixjQUE4QixFQUM5QixNQUFjO0lBRWQ7OztPQUdHO0lBQ0gsU0FBUyxnQkFBZ0IsQ0FDdkIsS0FBK0Q7UUFFL0QsSUFBSSxhQUFhLElBQUksS0FBSyxFQUFFLENBQUM7WUFDM0IsT0FBTyxLQUFLLENBQUM7UUFDZixDQUFDO1FBRUQsSUFBSSxDQUFDO1lBQ0gsb0JBQW9CO1lBQ3BCLE9BQU8sUUFBUSxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUM3QixDQUFDO1FBQUMsTUFBTSxDQUFDO1lBQ1AsdUJBQXVCO1lBQ3ZCLE9BQU8sS0FBeUIsQ0FBQztRQUNuQyxDQUFDO0lBQ0gsQ0FBQztJQUVEOzs7T0FHRztJQUNILFNBQVMscUJBQXFCLENBQzVCLE9BQStCO1FBRS9CLElBQUksT0FBTyxDQUFDLFdBQVcsRUFBRSxDQUFDO1lBQ3hCLE9BQU8sS0FBSyxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsV0FBVyxDQUFDO2dCQUN2QyxDQUFDLENBQUMsT0FBTyxDQUFDLFdBQVcsQ0FBQyxHQUFHLENBQUMsZ0JBQWdCLENBQUM7Z0JBQzNDLENBQUMsQ0FBQyxDQUFDLGdCQUFnQixDQUFDLE9BQU8sQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDO1FBQzlDLENBQUM7UUFFRCxPQUFPLEVBQUUsQ0FBQztJQUNaLENBQUM7SUFFRDs7Ozs7T0FLRztJQUNILFNBQVMsWUFBWSxDQUFDLEtBQXdDLEVBQUUsT0FBK0I7UUFDN0YsTUFBTSxXQUFXLEdBQUcsYUFBYSxJQUFJLEtBQUssQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQztRQUNuRixNQUFNLFVBQVUsR0FBRyxXQUFXLENBQUM7WUFDN0IsY0FBYyxFQUFFLGNBQWMsQ0FBQyxRQUFRO1lBQ3ZDLFdBQVcsRUFBRSxNQUFNLENBQUMsV0FBVyxDQUFDLFFBQVE7WUFDeEMsU0FBUyxFQUFFLE9BQU8sQ0FBQyxtQkFBeUM7U0FDN0QsQ0FBQyxDQUFDO1FBRUgsTUFBTSxZQUFZLEdBQUcsa0JBQWtCLENBQUMsVUFBVSxDQUFDLENBQUM7UUFFcEQsT0FBTyxhQUFhLENBQ2xCLFlBQVksQ0FBQyxJQUFJLENBQ2YsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUNQLFFBQVEsQ0FBQyxDQUFDLEtBQUssRUFBRSxFQUFFO1lBQ2pCLElBQUksZUFBZSxDQUFDLEtBQUssQ0FBQyxFQUFFLENBQUM7Z0JBQzNCLE1BQU0sSUFBSSwyQkFBMkIsQ0FDbkMsV0FBVyxLQUFLLENBQUMsUUFBUSxFQUFFLHVCQUF1QixFQUNsRCxLQUFLLENBQ04sQ0FBQztZQUNKLENBQUM7aUJBQU0sQ0FBQztnQkFDTixPQUFPLEVBQUUsQ0FBQyxLQUFLLENBQUMsQ0FBQztZQUNuQixDQUFDO1FBQ0gsQ0FBQyxDQUFDLENBQ0gsQ0FDRixDQUFDO0lBQ0osQ0FBQztJQUVELE9BQU8sU0FBUyxhQUFhLENBQUMsU0FBbUM7UUFDL0QsTUFBTSxRQUFRLEdBQUcsU0FBUyxDQUFDLEdBQUcsQ0FBQyxDQUFDLE9BQU8sRUFBRSxFQUFFO1lBQ3pDLE1BQU0sTUFBTSxHQUFHLHFCQUFxQixDQUFDLE9BQU8sQ0FBQyxDQUFDO1lBQzlDLE1BQU0sT0FBTyxHQUFHLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxLQUFLLEVBQUUsRUFBRSxDQUFDLFlBQVksQ0FBQyxLQUFLLEVBQUUsT0FBTyxDQUFDLENBQUMsQ0FBQztZQUNwRSxPQUFPLE9BQU8sQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDO2lCQUN4QixJQUFJLENBQUMsQ0FBQyxTQUFTLEVBQUUsRUFBRSxDQUFDLFNBQVMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDO2lCQUM5QyxJQUFJLENBQUMsQ0FBQyxXQUFXLEVBQUUsRUFBRSxDQUFDLENBQUM7Z0JBQ3RCLE9BQU87Z0JBQ1AsV0FBVzthQUNaLENBQUMsQ0FBQyxDQUFDO1FBQ1IsQ0FBQyxDQUFDLENBQUM7UUFFSCxPQUFPLE9BQU8sQ0FBQyxHQUFHLENBQUMsUUFBUSxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsTUFBTSxFQUFFLEVBQUUsQ0FDM0MsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDLFdBQVcsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUMxRCxDQUFDO0lBQ0osQ0FBQyxDQUFDO0FBQ0osQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdG9yLCBUeXBlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IEFjdGl2YXRlZFJvdXRlLCBSb3V0ZXIsIFVybFRyZWUgfSBmcm9tICdAYW5ndWxhci9yb3V0ZXInO1xyXG5pbXBvcnQgeyBDb21wb25lbnRSZW5kZXJpbmcgfSBmcm9tICdAc2l0ZWNvcmUtanNzL3NpdGVjb3JlLWpzcy9sYXlvdXQnO1xyXG5pbXBvcnQgeyBsYXN0VmFsdWVGcm9tLCBvZiB9IGZyb20gJ3J4anMnO1xyXG5pbXBvcnQgeyBtZXJnZU1hcCwgdGFrZSB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcclxuaW1wb3J0IHsgQ29tcG9uZW50RmFjdG9yeVJlc3VsdCB9IGZyb20gJy4vanNzLWNvbXBvbmVudC1mYWN0b3J5LnNlcnZpY2UnO1xyXG5pbXBvcnQgeyB3cmFwSW50b09ic2VydmFibGUgfSBmcm9tICcuLi91dGlscyc7XHJcbmltcG9ydCB7IEpzc0NhbkFjdGl2YXRlUmVkaXJlY3RFcnJvciB9IGZyb20gJy4vanNzLWNhbi1hY3RpdmF0ZS1lcnJvcic7XHJcbmltcG9ydCB7IEpzc0NhbkFjdGl2YXRlLCBKc3NDYW5BY3RpdmF0ZUZuIH0gZnJvbSAnLi9wbGFjZWhvbGRlci50b2tlbic7XHJcblxyXG4vKipcclxuICogQHBhcmFtIHtib29sZWFuIHwgc3RyaW5nIHwgc3RyaW5nW10gfCBVcmxUcmVlfSB2YWx1ZVxyXG4gKiBAcmV0dXJucyBpbnN0YW5jZSBvZiB2YWx1ZVxyXG4gKi9cclxuZnVuY3Rpb24gaXNSZWRpcmVjdFZhbHVlKFxyXG4gIHZhbHVlOiBib29sZWFuIHwgc3RyaW5nIHwgc3RyaW5nW10gfCBVcmxUcmVlXHJcbik6IHZhbHVlIGlzIHN0cmluZyB8IHN0cmluZ1tdIHwgVXJsVHJlZSB7XHJcbiAgcmV0dXJuIHZhbHVlIGluc3RhbmNlb2YgVXJsVHJlZSB8fCB0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnIHx8IEFycmF5LmlzQXJyYXkodmFsdWUpO1xyXG59XHJcblxyXG4vKipcclxuICogUmVzb2x2ZXMgY29tcG9uZW50cyBiYXNlZCBvbiBwcm92aWRlZCBndWFyZHNcclxuICogQHBhcmFtIHtJbmplY3Rvcn0gaW5qZWN0b3JcclxuICogQHBhcmFtIHtBY3RpdmF0ZWRSb3V0ZX0gYWN0aXZhdGVkUm91dGVcclxuICogQHBhcmFtIHtSb3V0ZXJ9IHJvdXRlclxyXG4gKiBAcmV0dXJucyB7KGZhY3RvcmllczogQ29tcG9uZW50RmFjdG9yeVJlc3VsdFtdKSA9PiBQcm9taXNlPENvbXBvbmVudEZhY3RvcnlSZXN1bHRbXT59IGZhY3RvcnlcclxuICovXHJcbmV4cG9ydCBmdW5jdGlvbiBndWFyZFJlc29sdmVyRmFjdG9yeShcclxuICBpbmplY3RvcjogSW5qZWN0b3IsXHJcbiAgYWN0aXZhdGVkUm91dGU6IEFjdGl2YXRlZFJvdXRlLFxyXG4gIHJvdXRlcjogUm91dGVyXHJcbikge1xyXG4gIC8qKlxyXG4gICAqIEBwYXJhbSB7SnNzQ2FuQWN0aXZhdGUgfCBUeXBlPEpzc0NhbkFjdGl2YXRlPiB8IEpzc0NhbkFjdGl2YXRlRm59IGd1YXJkXHJcbiAgICogQHJldHVybnMgcmVzb2x2ZWQgZ3VhcmRcclxuICAgKi9cclxuICBmdW5jdGlvbiBnZXRHdWFyZEluc3RhbmNlKFxyXG4gICAgZ3VhcmQ6IEpzc0NhbkFjdGl2YXRlIHwgVHlwZTxKc3NDYW5BY3RpdmF0ZT4gfCBKc3NDYW5BY3RpdmF0ZUZuXHJcbiAgKTogSnNzQ2FuQWN0aXZhdGUgfCBKc3NDYW5BY3RpdmF0ZUZuIHtcclxuICAgIGlmICgnY2FuQWN0aXZhdGUnIGluIGd1YXJkKSB7XHJcbiAgICAgIHJldHVybiBndWFyZDtcclxuICAgIH1cclxuXHJcbiAgICB0cnkge1xyXG4gICAgICAvLyBDbGFzcyBpcyBwcm92aWRlZFxyXG4gICAgICByZXR1cm4gaW5qZWN0b3IuZ2V0KGd1YXJkKTtcclxuICAgIH0gY2F0Y2gge1xyXG4gICAgICAvLyBGdW5jdGlvbiBpcyBwcm92aWRlZFxyXG4gICAgICByZXR1cm4gZ3VhcmQgYXMgSnNzQ2FuQWN0aXZhdGVGbjtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEBwYXJhbSB7Q29tcG9uZW50RmFjdG9yeVJlc3VsdH0gZmFjdG9yeVxyXG4gICAqIEByZXR1cm5zIHsoSnNzQ2FuQWN0aXZhdGUgfCBKc3NDYW5BY3RpdmF0ZUZuKVtdfSBndWFyZCBpbnN0YW5jZXNcclxuICAgKi9cclxuICBmdW5jdGlvbiBjb2xsZWN0R3VhcmRJbnN0YW5jZXMoXHJcbiAgICBmYWN0b3J5OiBDb21wb25lbnRGYWN0b3J5UmVzdWx0XHJcbiAgKTogKEpzc0NhbkFjdGl2YXRlIHwgSnNzQ2FuQWN0aXZhdGVGbilbXSB7XHJcbiAgICBpZiAoZmFjdG9yeS5jYW5BY3RpdmF0ZSkge1xyXG4gICAgICByZXR1cm4gQXJyYXkuaXNBcnJheShmYWN0b3J5LmNhbkFjdGl2YXRlKVxyXG4gICAgICAgID8gZmFjdG9yeS5jYW5BY3RpdmF0ZS5tYXAoZ2V0R3VhcmRJbnN0YW5jZSlcclxuICAgICAgICA6IFtnZXRHdWFyZEluc3RhbmNlKGZhY3RvcnkuY2FuQWN0aXZhdGUpXTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gW107XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKlxyXG4gICAqIEBwYXJhbSB7SnNzQ2FuQWN0aXZhdGUgfCBKc3NDYW5BY3RpdmF0ZUZufSBndWFyZFxyXG4gICAqIEBwYXJhbSB7Q29tcG9uZW50RmFjdG9yeVJlc3VsdH0gZmFjdG9yeVxyXG4gICAqIEByZXR1cm5zIGNhbkFjdGl2YXRlXHJcbiAgICovXHJcbiAgZnVuY3Rpb24gcmVzb2x2ZUd1YXJkKGd1YXJkOiBKc3NDYW5BY3RpdmF0ZSB8IEpzc0NhbkFjdGl2YXRlRm4sIGZhY3Rvcnk6IENvbXBvbmVudEZhY3RvcnlSZXN1bHQpIHtcclxuICAgIGNvbnN0IGNhbkFjdGl2YXRlID0gJ2NhbkFjdGl2YXRlJyBpbiBndWFyZCA/IGd1YXJkLmNhbkFjdGl2YXRlLmJpbmQoZ3VhcmQpIDogZ3VhcmQ7XHJcbiAgICBjb25zdCBndWFyZFZhbHVlID0gY2FuQWN0aXZhdGUoe1xyXG4gICAgICBhY3RpdmF0ZWRSb3V0ZTogYWN0aXZhdGVkUm91dGUuc25hcHNob3QsXHJcbiAgICAgIHJvdXRlclN0YXRlOiByb3V0ZXIucm91dGVyU3RhdGUuc25hcHNob3QsXHJcbiAgICAgIHJlbmRlcmluZzogZmFjdG9yeS5jb21wb25lbnREZWZpbml0aW9uIGFzIENvbXBvbmVudFJlbmRlcmluZyxcclxuICAgIH0pO1xyXG5cclxuICAgIGNvbnN0IGNhbkFjdGl2YXRlJCA9IHdyYXBJbnRvT2JzZXJ2YWJsZShndWFyZFZhbHVlKTtcclxuXHJcbiAgICByZXR1cm4gbGFzdFZhbHVlRnJvbShcclxuICAgICAgY2FuQWN0aXZhdGUkLnBpcGUoXHJcbiAgICAgICAgdGFrZSgxKSxcclxuICAgICAgICBtZXJnZU1hcCgodmFsdWUpID0+IHtcclxuICAgICAgICAgIGlmIChpc1JlZGlyZWN0VmFsdWUodmFsdWUpKSB7XHJcbiAgICAgICAgICAgIHRocm93IG5ldyBKc3NDYW5BY3RpdmF0ZVJlZGlyZWN0RXJyb3IoXHJcbiAgICAgICAgICAgICAgYFZhbHVlOiAnJHt2YWx1ZS50b1N0cmluZygpfScgaXMgYSByZWRpcmVjdCB2YWx1ZWAsXHJcbiAgICAgICAgICAgICAgdmFsdWVcclxuICAgICAgICAgICAgKTtcclxuICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHJldHVybiBvZih2YWx1ZSk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSlcclxuICAgICAgKVxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIHJldHVybiBmdW5jdGlvbiByZXNvbHZlR3VhcmRzKGZhY3RvcmllczogQ29tcG9uZW50RmFjdG9yeVJlc3VsdFtdKSB7XHJcbiAgICBjb25zdCByZXNvbHZlZCA9IGZhY3Rvcmllcy5tYXAoKGZhY3RvcnkpID0+IHtcclxuICAgICAgY29uc3QgZ3VhcmRzID0gY29sbGVjdEd1YXJkSW5zdGFuY2VzKGZhY3RvcnkpO1xyXG4gICAgICBjb25zdCBwZW5kaW5nID0gZ3VhcmRzLm1hcCgoZ3VhcmQpID0+IHJlc29sdmVHdWFyZChndWFyZCwgZmFjdG9yeSkpO1xyXG4gICAgICByZXR1cm4gUHJvbWlzZS5hbGwocGVuZGluZylcclxuICAgICAgICAudGhlbigoY2FuQWN0aXZlKSA9PiBjYW5BY3RpdmUuZXZlcnkoKHYpID0+IHYpKVxyXG4gICAgICAgIC50aGVuKChjYW5BY3RpdmF0ZSkgPT4gKHtcclxuICAgICAgICAgIGZhY3RvcnksXHJcbiAgICAgICAgICBjYW5BY3RpdmF0ZSxcclxuICAgICAgICB9KSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICByZXR1cm4gUHJvbWlzZS5hbGwocmVzb2x2ZWQpLnRoZW4oKG1hcHBlZCkgPT5cclxuICAgICAgbWFwcGVkLmZpbHRlcigobSkgPT4gbS5jYW5BY3RpdmF0ZSkubWFwKChtKSA9PiBtLmZhY3RvcnkpXHJcbiAgICApO1xyXG4gIH07XHJcbn1cclxuIl19","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}