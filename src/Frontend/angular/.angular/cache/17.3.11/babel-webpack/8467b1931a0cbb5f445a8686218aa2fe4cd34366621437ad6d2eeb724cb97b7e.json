{"ast":null,"code":"import { Directive, Input } from '@angular/core';\nimport { mediaApi } from '@sitecore-jss/sitecore-jss/media';\nimport { BaseFieldDirective } from './base-field.directive';\nimport { DefaultEmptyImageFieldEditingComponent } from './default-empty-image-field-editing-placeholder.component';\nimport { MetadataKind } from '@sitecore-jss/sitecore-jss/editing';\nimport * as i0 from \"@angular/core\";\nexport let ImageDirective = /*#__PURE__*/(() => {\n  class ImageDirective extends BaseFieldDirective {\n    templateRef;\n    renderer;\n    elementRef;\n    field;\n    editable = true;\n    /**\n     * Custom regexp that finds media URL prefix that will be replaced by `/-/jssmedia` or `/~/jssmedia`.\n     * @example\n     * /\\/([-~]{1})assets\\//i\n     * /-assets/website -> /-/jssmedia/website\n     * /~assets/website -> /~/jssmedia/website\n     */\n    mediaUrlPrefix;\n    urlParams = {};\n    attrs = {};\n    /**\n     * Custom template to render in Pages in Metadata edit mode if field value is empty\n     */\n    emptyFieldEditingTemplate;\n    /**\n     * Default component to render in Pages in Metadata edit mode if field value is empty and emptyFieldEditingTemplate is not provided\n     */\n    defaultFieldEditingComponent;\n    inlineRef = null;\n    constructor(viewContainer, templateRef, renderer, elementRef) {\n      super(viewContainer);\n      this.templateRef = templateRef;\n      this.renderer = renderer;\n      this.elementRef = elementRef;\n      this.defaultFieldEditingComponent = DefaultEmptyImageFieldEditingComponent;\n    }\n    ngOnChanges(changes) {\n      if (changes.field || changes.editable || changes.urlParams || changes.attrs) {\n        this.viewContainer.clear();\n        if (this.inlineRef) {\n          this.inlineRef.remove();\n          this.inlineRef = null;\n        }\n        this.updateView();\n      }\n    }\n    updateView() {\n      if (!this.shouldRender()) {\n        super.renderEmpty();\n        return;\n      }\n      const overrideAttrs = {\n        ...this.getElementAttrs(),\n        ...this.attrs\n      };\n      const media = this.field;\n      let attrs = {};\n      // we likely have an experience editor value, should be a string\n      if (this.editable && media.editable) {\n        const foundImg = mediaApi.findEditorImageTag(media.editable);\n        if (!foundImg) {\n          return this.renderInlineWrapper(media.editable);\n        }\n        attrs = this.getImageAttrs(foundImg.attrs, overrideAttrs, this.urlParams);\n        if (!attrs) {\n          return this.renderInlineWrapper(media.editable);\n        }\n        const tempImg = this.renderer.createElement('img');\n        Object.entries(attrs).forEach(([key, attrValue]) => tempImg.setAttribute(key, attrValue));\n        const editableMarkup = media.editable.replace(foundImg.imgTag, tempImg.outerHTML);\n        return this.renderInlineWrapper(editableMarkup);\n      }\n      // some wise-guy/gal is passing in a 'raw' image object value\n      const img = media.src ? media : media.value;\n      if (!img) {\n        return null;\n      }\n      attrs = this.getImageAttrs(img, overrideAttrs, this.urlParams);\n      if (attrs) {\n        this.renderMetadata(MetadataKind.Open);\n        this.renderTemplate(attrs);\n        this.renderMetadata(MetadataKind.Close);\n      }\n    }\n    getImageAttrs(fieldAttrs, parsedAttrs, imageParams) {\n      const combinedAttrs = {\n        ...fieldAttrs,\n        ...parsedAttrs\n      };\n      // eslint-disable-next-line prefer-const\n      let {\n        src,\n        srcSet,\n        style,\n        ...otherAttrs\n      } = combinedAttrs;\n      if (!src) {\n        return null;\n      }\n      const newAttrs = {\n        ...otherAttrs\n      };\n      // update image URL for jss handler and image rendering params\n      src = mediaApi.updateImageUrl(src, imageParams, this.mediaUrlPrefix);\n      if (srcSet) {\n        // replace with HTML-formatted srcset, including updated image URLs\n        newAttrs.srcSet = mediaApi.getSrcSet(src, srcSet, imageParams, this.mediaUrlPrefix);\n      } else {\n        newAttrs.src = src;\n      }\n      if (style) {\n        newAttrs.style = Object.entries(style).map(([propName, value]) => `${propName}:${value}`).join(';');\n      }\n      return newAttrs;\n    }\n    renderTemplate(imageProps) {\n      const viewRef = this.viewContainer.createEmbeddedView(this.templateRef);\n      viewRef.rootNodes.forEach(node => {\n        Object.entries(imageProps).forEach(([key, imgPropVal]) => this.renderer.setAttribute(node, key, imgPropVal));\n      });\n    }\n    getElementAttrs() {\n      const view = this.templateRef.createEmbeddedView(null);\n      const element = view.rootNodes[0];\n      if (!element) {\n        view.destroy();\n        return {};\n      }\n      const attrs = {};\n      for (let i = 0; i < element.attributes.length; i++) {\n        const attr = element.attributes.item(i);\n        if (attr) {\n          attrs[attr.name] = attr.value;\n        }\n      }\n      view.destroy();\n      return attrs;\n    }\n    renderInlineWrapper(editable) {\n      const span = this.renderer.createElement('span');\n      span.className = 'sc-image-wrapper';\n      span.innerHTML = editable;\n      const parentNode = this.renderer.parentNode(this.elementRef.nativeElement);\n      this.renderer.insertBefore(parentNode, span, this.elementRef.nativeElement);\n      parentNode.removeChild(this.elementRef.nativeElement);\n      this.inlineRef = span;\n    }\n    static ɵfac = function ImageDirective_Factory(t) {\n      return new (t || ImageDirective)(i0.ɵɵdirectiveInject(i0.ViewContainerRef), i0.ɵɵdirectiveInject(i0.TemplateRef), i0.ɵɵdirectiveInject(i0.Renderer2), i0.ɵɵdirectiveInject(i0.ElementRef));\n    };\n    static ɵdir = /* @__PURE__ */i0.ɵɵdefineDirective({\n      type: ImageDirective,\n      selectors: [[\"\", \"scImage\", \"\"]],\n      inputs: {\n        field: [i0.ɵɵInputFlags.None, \"scImage\", \"field\"],\n        editable: [i0.ɵɵInputFlags.None, \"scImageEditable\", \"editable\"],\n        mediaUrlPrefix: [i0.ɵɵInputFlags.None, \"scImageMediaUrlPrefix\", \"mediaUrlPrefix\"],\n        urlParams: [i0.ɵɵInputFlags.None, \"scImageUrlParams\", \"urlParams\"],\n        attrs: [i0.ɵɵInputFlags.None, \"scImageAttrs\", \"attrs\"],\n        emptyFieldEditingTemplate: [i0.ɵɵInputFlags.None, \"scImageEmptyFieldEditingTemplate\", \"emptyFieldEditingTemplate\"]\n      },\n      features: [i0.ɵɵInheritDefinitionFeature, i0.ɵɵNgOnChangesFeature]\n    });\n  }\n  return ImageDirective;\n})();\n(() => {\n  (typeof ngDevMode === \"undefined\" || ngDevMode) && void 0;\n})();\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW1hZ2UuZGlyZWN0aXZlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL2NvbXBvbmVudHMvaW1hZ2UuZGlyZWN0aXZlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFDTCxTQUFTLEVBRVQsS0FBSyxHQU9OLE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFBRSxRQUFRLEVBQUUsTUFBTSxrQ0FBa0MsQ0FBQztBQUU1RCxPQUFPLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSx3QkFBd0IsQ0FBQztBQUM1RCxPQUFPLEVBQUUsc0NBQXNDLEVBQUUsTUFBTSwyREFBMkQsQ0FBQztBQUNuSCxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0sb0NBQW9DLENBQUM7O0FBR2xFLE1BQU0sT0FBTyxjQUFlLFNBQVEsa0JBQWtCO0lBZ0MxQztJQUNBO0lBQ0E7SUFqQ1EsS0FBSyxDQUFhO0lBRVYsUUFBUSxHQUFHLElBQUksQ0FBQztJQUUxQzs7Ozs7O09BTUc7SUFDNkIsY0FBYyxDQUFVO0lBRTdCLFNBQVMsR0FBeUMsRUFBRSxDQUFDO0lBRXpELEtBQUssR0FBaUMsRUFBRSxDQUFDO0lBRWhFOztPQUVHO0lBQ3dDLHlCQUF5QixDQUF1QjtJQUUzRjs7T0FFRztJQUNPLDRCQUE0QixDQUFnQjtJQUU5QyxTQUFTLEdBQTJCLElBQUksQ0FBQztJQUVqRCxZQUNFLGFBQStCLEVBQ3ZCLFdBQWlDLEVBQ2pDLFFBQW1CLEVBQ25CLFVBQXNCO1FBRTlCLEtBQUssQ0FBQyxhQUFhLENBQUMsQ0FBQztRQUpiLGdCQUFXLEdBQVgsV0FBVyxDQUFzQjtRQUNqQyxhQUFRLEdBQVIsUUFBUSxDQUFXO1FBQ25CLGVBQVUsR0FBVixVQUFVLENBQVk7UUFHOUIsSUFBSSxDQUFDLDRCQUE0QixHQUFHLHNDQUFzQyxDQUFDO0lBQzdFLENBQUM7SUFFRCxXQUFXLENBQUMsT0FBc0I7UUFDaEMsSUFBSSxPQUFPLENBQUMsS0FBSyxJQUFJLE9BQU8s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QUFJLEdBQW9CLElBQUksQ0FBQyxRQUFRLENBQUMsYUFBYSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQ2xFLElBQUksQ0FBQyxTQUFTLEdBQUcsa0JBQWtCLENBQUM7UUFDcEMsSUFBSSxDQUFDLFNBQVMsR0FBRyxRQUFRLENBQUM7UUFFMUIsTUFBTSxVQUFVLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxhQUFhLENBQUMsQ0FBQztRQUMzRSxJQUFJLENBQUMsUUFBUSxDQUFDLFlBQVksQ0FBQyxVQUFVLEVBQUUsSUFBSSxFQUFFLElBQUksQ0FBQyxVQUFVLENBQUMsYUFBYSxDQUFDLENBQUM7UUFDNUUsVUFBVSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLGFBQWEsQ0FBQyxDQUFDO1FBRXRELElBQUksQ0FBQyxTQUFTLEdBQUcsSUFBSSxDQUFDO0lBQ3hCLENBQUM7d0dBMUtVLGNBQWM7NEZBQWQsY0FBYzs7NEZBQWQsY0FBYztrQkFEMUIsU0FBUzttQkFBQyxFQUFFLFFBQVEsRUFBRSxXQUFXLEVBQUU7Z0tBRWhCLEtBQUs7c0JBQXRCLEtBQUs7dUJBQUMsU0FBUztnQkFFVSxRQUFRO3NCQUFqQyxLQUFLO3VCQUFDLGlCQUFpQjtnQkFTUSxjQUFjO3NCQUE3QyxLQUFLO3VCQUFDLHVCQUF1QjtnQkFFSCxTQUFTO3NCQUFuQyxLQUFLO3VCQUFDLGtCQUFrQjtnQkFFRixLQUFLO3NCQUEzQixLQUFLO3VCQUFDLGNBQWM7Z0JBS3NCLHlCQUF5QjtzQkFBbkUsS0FBSzt1QkFBQyxrQ0FBa0MiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xyXG4gIERpcmVjdGl2ZSxcclxuICBFbGVtZW50UmVmLFxyXG4gIElucHV0LFxyXG4gIE9uQ2hhbmdlcyxcclxuICBSZW5kZXJlcjIsXHJcbiAgU2ltcGxlQ2hhbmdlcyxcclxuICBUZW1wbGF0ZVJlZixcclxuICBUeXBlLFxyXG4gIFZpZXdDb250YWluZXJSZWYsXHJcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IG1lZGlhQXBpIH0gZnJvbSAnQHNpdGVjb3JlLWpzcy9zaXRlY29yZS1qc3MvbWVkaWEnO1xyXG5pbXBvcnQgeyBJbWFnZUZpZWxkLCBJbWFnZUZpZWxkVmFsdWUgfSBmcm9tICcuL3JlbmRlcmluZy1maWVsZCc7XHJcbmltcG9ydCB7IEJhc2VGaWVsZERpcmVjdGl2ZSB9IGZyb20gJy4vYmFzZS1maWVsZC5kaXJlY3RpdmUnO1xyXG5pbXBvcnQgeyBEZWZhdWx0RW1wdHlJbWFnZUZpZWxkRWRpdGluZ0NvbXBvbmVudCB9IGZyb20gJy4vZGVmYXVsdC1lbXB0eS1pbWFnZS1maWVsZC1lZGl0aW5nLXBsYWNlaG9sZGVyLmNvbXBvbmVudCc7XHJcbmltcG9ydCB7IE1ldGFkYXRhS2luZCB9IGZyb20gJ0BzaXRlY29yZS1qc3Mvc2l0ZWNvcmUtanNzL2VkaXRpbmcnO1xyXG5cclxuQERpcmVjdGl2ZSh7IHNlbGVjdG9yOiAnW3NjSW1hZ2VdJyB9KVxyXG5leHBvcnQgY2xhc3MgSW1hZ2VEaXJlY3RpdmUgZXh0ZW5kcyBCYXNlRmllbGREaXJlY3RpdmUgaW1wbGVtZW50cyBPbkNoYW5nZXMge1xyXG4gIEBJbnB1dCgnc2NJbWFnZScpIGZpZWxkOiBJbWFnZUZpZWxkO1xyXG5cclxuICBASW5wdXQoJ3NjSW1hZ2VFZGl0YWJsZScpIGVkaXRhYmxlID0gdHJ1ZTtcclxuXHJcbiAgLyoqXHJcbiAgICogQ3VzdG9tIHJlZ2V4cCB0aGF0IGZpbmRzIG1lZGlhIFVSTCBwcmVmaXggdGhhdCB3aWxsIGJlIHJlcGxhY2VkIGJ5IGAvLS9qc3NtZWRpYWAgb3IgYC9+L2pzc21lZGlhYC5cclxuICAgKiBAZXhhbXBsZVxyXG4gICAqIC9cXC8oWy1+XXsxfSlhc3NldHNcXC8vaVxyXG4gICAqIC8tYXNzZXRzL3dlYnNpdGUgLT4gLy0vanNzbWVkaWEvd2Vic2l0ZVxyXG4gICAqIC9+YXNzZXRzL3dlYnNpdGUgLT4gL34vanNzbWVkaWEvd2Vic2l0ZVxyXG4gICAqL1xyXG4gIEBJbnB1dCgnc2NJbWFnZU1lZGlhVXJsUHJlZml4JykgbWVkaWFVcmxQcmVmaXg/OiBSZWdFeHA7XHJcblxyXG4gIEBJbnB1dCgnc2NJbWFnZVVybFBhcmFtcycpIHVybFBhcmFtczogeyBbcGFyYW06IHN0cmluZ106IHN0cmluZyB8IG51bWJlciB9ID0ge307XHJcblxyXG4gIEBJbnB1dCgnc2NJbWFnZUF0dHJzJykgYXR0cnM6IHsgW3BhcmFtOiBzdHJpbmddOiB1bmtub3duIH0gPSB7fTtcclxuXHJcbiAgLyoqXHJcbiAgICogQ3VzdG9tIHRlbXBsYXRlIHRvIHJlbmRlciBpbiBQYWdlcyBpbiBNZXRhZGF0YSBlZGl0IG1vZGUgaWYgZmllbGQgdmFsdWUgaXMgZW1wdHlcclxuICAgKi9cclxuICBASW5wdXQoJ3NjSW1hZ2VFbXB0eUZpZWxkRWRpdGluZ1RlbXBsYXRlJykgZW1wdHlGaWVsZEVkaXRpbmdUZW1wbGF0ZTogVGVtcGxhdGVSZWY8dW5rbm93bj47XHJcblxyXG4gIC8qKlxyXG4gICAqIERlZmF1bHQgY29tcG9uZW50IHRvIHJlbmRlciBpbiBQYWdlcyBpbiBNZXRhZGF0YSBlZGl0IG1vZGUgaWYgZmllbGQgdmFsdWUgaXMgZW1wdHkgYW5kIGVtcHR5RmllbGRFZGl0aW5nVGVtcGxhdGUgaXMgbm90IHByb3ZpZGVkXHJcbiAgICovXHJcbiAgcHJvdGVjdGVkIGRlZmF1bHRGaWVsZEVkaXRpbmdDb21wb25lbnQ6IFR5cGU8dW5rbm93bj47XHJcblxyXG4gIHByaXZhdGUgaW5saW5lUmVmOiBIVE1MU3BhbkVsZW1lbnQgfCBudWxsID0gbnVsbDtcclxuXHJcbiAgY29uc3RydWN0b3IoXHJcbiAgICB2aWV3Q29udGFpbmVyOiBWaWV3Q29udGFpbmVyUmVmLFxyXG4gICAgcHJpdmF0ZSB0ZW1wbGF0ZVJlZjogVGVtcGxhdGVSZWY8dW5rbm93bj4sXHJcbiAgICBwcml2YXRlIHJlbmRlcmVyOiBSZW5kZXJlcjIsXHJcbiAgICBwcml2YXRlIGVsZW1lbnRSZWY6IEVsZW1lbnRSZWZcclxuICApIHtcclxuICAgIHN1cGVyKHZpZXdDb250YWluZXIpO1xyXG4gICAgdGhpcy5kZWZhdWx0RmllbGRFZGl0aW5nQ29tcG9uZW50ID0gRGVmYXVsdEVtcHR5SW1hZ2VGaWVsZEVkaXRpbmdDb21wb25lbnQ7XHJcbiAgfVxyXG5cclxuICBuZ09uQ2hhbmdlcyhjaGFuZ2VzOiBTaW1wbGVDaGFuZ2VzKSB7XHJcbiAgICBpZiAoY2hhbmdlcy5maWVsZCB8fCBjaGFuZ2VzLmVkaXRhYmxlIHx8IGNoYW5nZXMudXJsUGFyYW1zIHx8IGNoYW5nZXMuYXR0cnMpIHtcclxuICAgICAgdGhpcy52aWV3Q29udGFpbmVyLmNsZWFyKCk7XHJcbiAgICAgIGlmICh0aGlzLmlubGluZVJlZikge1xyXG4gICAgICAgIHRoaXMuaW5saW5lUmVmLnJlbW92ZSgpO1xyXG4gICAgICAgIHRoaXMuaW5saW5lUmVmID0gbnVsbDtcclxuICAgICAgfVxyXG5cclxuICAgICAgdGhpcy51cGRhdGVWaWV3KCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHVwZGF0ZVZpZXcoKSB7XHJcbiAgICBpZiAoIXRoaXMuc2hvdWxkUmVuZGVyKCkpIHtcclxuICAgICAgc3VwZXIucmVuZGVyRW1wdHkoKTtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IG92ZXJyaWRlQXR0cnMgPSB7XHJcbiAgICAgIC4uLnRoaXMuZ2V0RWxlbWVudEF0dHJzKCksXHJcbiAgICAgIC4uLnRoaXMuYXR0cnMsXHJcbiAgICB9O1xyXG4gICAgY29uc3QgbWVkaWEgPSB0aGlzLmZpZWxkO1xyXG5cclxuICAgIGxldCBhdHRyczogeyBbYXR0cjogc3RyaW5nXTogc3RyaW5nIH0gfCBudWxsID0ge307XHJcblxyXG4gICAgLy8gd2UgbGlrZWx5IGhhdmUgYW4gZXhwZXJpZW5jZSBlZGl0b3IgdmFsdWUsIHNob3VsZCBiZSBhIHN0cmluZ1xyXG4gICAgaWYgKHRoaXMuZWRpdGFibGUgJiYgbWVkaWEuZWRpdGFibGUpIHtcclxuICAgICAgY29uc3QgZm91bmRJbWcgPSBtZWRpYUFwaS5maW5kRWRpdG9ySW1hZ2VUYWcobWVkaWEuZWRpdGFibGUpO1xyXG4gICAgICBpZiAoIWZvdW5kSW1nKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMucmVuZGVySW5saW5lV3JhcHBlcihtZWRpYS5lZGl0YWJsZSk7XHJcbiAgICAgIH1cclxuICAgICAgYXR0cnMgPSB0aGlzLmdldEltYWdlQXR0cnMoZm91bmRJbWcuYXR0cnMsIG92ZXJyaWRlQXR0cnMsIHRoaXMudXJsUGFyYW1zKTtcclxuICAgICAgaWYgKCFhdHRycykge1xyXG4gICAgICAgIHJldHVybiB0aGlzLnJlbmRlcklubGluZVdyYXBwZXIobWVkaWEuZWRpdGFibGUpO1xyXG4gICAgICB9XHJcbiAgICAgIGNvbnN0IHRlbXBJbWc6IEhUTUxJbWFnZUVsZW1lbnQgPSB0aGlzLnJlbmRlcmVyLmNyZWF0ZUVsZW1lbnQoJ2ltZycpO1xyXG4gICAgICBPYmplY3QuZW50cmllcyhhdHRycykuZm9yRWFjaCgoW2tleSwgYXR0clZhbHVlXTogW3N0cmluZywgc3RyaW5nXSkgPT5cclxuICAgICAgICB0ZW1wSW1nLnNldEF0dHJpYnV0ZShrZXksIGF0dHJWYWx1ZSlcclxuICAgICAgKTtcclxuICAgICAgY29uc3QgZWRpdGFibGVNYXJrdXAgPSBtZWRpYS5lZGl0YWJsZS5yZXBsYWNlKGZvdW5kSW1nLmltZ1RhZywgdGVtcEltZy5vdXRlckhUTUwpO1xyXG4gICAgICByZXR1cm4gdGhpcy5yZW5kZXJJbmxpbmVXcmFwcGVyKGVkaXRhYmxlTWFya3VwKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBzb21lIHdpc2UtZ3V5L2dhbCBpcyBwYXNzaW5nIGluIGEgJ3JhdycgaW1hZ2Ugb2JqZWN0IHZhbHVlXHJcbiAgICBjb25zdCBpbWcgPSBtZWRpYS5zcmMgPyBtZWRpYSA6IG1lZGlhLnZhbHVlO1xyXG4gICAgaWYgKCFpbWcpIHtcclxuICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICB9XHJcblxyXG4gICAgYXR0cnMgPSB0aGlzLmdldEltYWdlQXR0cnMoaW1nLCBvdmVycmlkZUF0dHJzLCB0aGlzLnVybFBhcmFtcyk7XHJcbiAgICBpZiAoYXR0cnMpIHtcclxuICAgICAgdGhpcy5yZW5kZXJNZXRhZGF0YShNZXRhZGF0YUtpbmQuT3Blbik7XHJcbiAgICAgIHRoaXMucmVuZGVyVGVtcGxhdGUoYXR0cnMpO1xyXG4gICAgICB0aGlzLnJlbmRlck1ldGFkYXRhKE1ldGFkYXRhS2luZC5DbG9zZSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGdldEltYWdlQXR0cnMoXHJcbiAgICBmaWVsZEF0dHJzOiBJbWFnZUZpZWxkVmFsdWUsXHJcbiAgICBwYXJzZWRBdHRyczogeyBbYXR0cjogc3RyaW5nXTogdW5rbm93biB9LFxyXG4gICAgaW1hZ2VQYXJhbXM6IHsgW3BhcmFtOiBzdHJpbmddOiBzdHJpbmcgfCBudW1iZXIgfVxyXG4gICk6IHsgW2F0dHI6IHN0cmluZ106IHN0cmluZyB9IHwgbnVsbCB7XHJcbiAgICBjb25zdCBjb21iaW5lZEF0dHJzID0ge1xyXG4gICAgICAuLi5maWVsZEF0dHJzLFxyXG4gICAgICAuLi5wYXJzZWRBdHRycyxcclxuICAgIH07XHJcbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgcHJlZmVyLWNvbnN0XHJcbiAgICBsZXQgeyBzcmMsIHNyY1NldCwgc3R5bGUsIC4uLm90aGVyQXR0cnMgfSA9IGNvbWJpbmVkQXR0cnM7XHJcbiAgICBpZiAoIXNyYykge1xyXG4gICAgICByZXR1cm4gbnVsbDtcclxuICAgIH1cclxuICAgIGNvbnN0IG5ld0F0dHJzOiB7IFthdHRyOiBzdHJpbmddOiBzdHJpbmcgfSA9IHtcclxuICAgICAgLi4uKG90aGVyQXR0cnMgYXMgeyBba2V5OiBzdHJpbmddOiBzdHJpbmcgfSksXHJcbiAgICB9O1xyXG4gICAgLy8gdXBkYXRlIGltYWdlIFVSTCBmb3IganNzIGhhbmRsZXIgYW5kIGltYWdlIHJlbmRlcmluZyBwYXJhbXNcclxuICAgIHNyYyA9IG1lZGlhQXBpLnVwZGF0ZUltYWdlVXJsKHNyYywgaW1hZ2VQYXJhbXMsIHRoaXMubWVkaWFVcmxQcmVmaXgpO1xyXG4gICAgaWYgKHNyY1NldCkge1xyXG4gICAgICAvLyByZXBsYWNlIHdpdGggSFRNTC1mb3JtYXR0ZWQgc3Jjc2V0LCBpbmNsdWRpbmcgdXBkYXRlZCBpbWFnZSBVUkxzXHJcbiAgICAgIG5ld0F0dHJzLnNyY1NldCA9IG1lZGlhQXBpLmdldFNyY1NldChzcmMsIHNyY1NldCwgaW1hZ2VQYXJhbXMsIHRoaXMubWVkaWFVcmxQcmVmaXgpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgbmV3QXR0cnMuc3JjID0gc3JjO1xyXG4gICAgfVxyXG5cclxuICAgIGlmIChzdHlsZSkge1xyXG4gICAgICBuZXdBdHRycy5zdHlsZSA9IE9iamVjdC5lbnRyaWVzKHN0eWxlIGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+KVxyXG4gICAgICAgIC5tYXAoKFtwcm9wTmFtZSwgdmFsdWVdKSA9PiBgJHtwcm9wTmFtZX06JHt2YWx1ZX1gKVxyXG4gICAgICAgIC5qb2luKCc7Jyk7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIG5ld0F0dHJzO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSByZW5kZXJUZW1wbGF0ZShpbWFnZVByb3BzOiB7IFtwcm9wOiBzdHJpbmddOiBzdHJpbmcgfSkge1xyXG4gICAgY29uc3Qgdmlld1JlZiA9IHRoaXMudmlld0NvbnRhaW5lci5jcmVhdGVFbWJlZGRlZFZpZXcodGhpcy50ZW1wbGF0ZVJlZik7XHJcbiAgICB2aWV3UmVmLnJvb3ROb2Rlcy5mb3JFYWNoKChub2RlKSA9PiB7XHJcbiAgICAgIE9iamVjdC5lbnRyaWVzKGltYWdlUHJvcHMpLmZvckVhY2goKFtrZXksIGltZ1Byb3BWYWxdOiBbc3RyaW5nLCBzdHJpbmddKSA9PlxyXG4gICAgICAgIHRoaXMucmVuZGVyZXIuc2V0QXR0cmlidXRlKG5vZGUsIGtleSwgaW1nUHJvcFZhbClcclxuICAgICAgKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBnZXRFbGVtZW50QXR0cnMoKTogeyBba2V5OiBzdHJpbmddOiBzdHJpbmcgfSB7XHJcbiAgICBjb25zdCB2aWV3ID0gdGhpcy50ZW1wbGF0ZVJlZi5jcmVhdGVFbWJlZGRlZFZpZXcobnVsbCk7XHJcbiAgICBjb25zdCBlbGVtZW50OiBFbGVtZW50ID0gdmlldy5yb290Tm9kZXNbMF07XHJcbiAgICBpZiAoIWVsZW1lbnQpIHtcclxuICAgICAgdmlldy5kZXN0cm95KCk7XHJcbiAgICAgIHJldHVybiB7fTtcclxuICAgIH1cclxuICAgIGNvbnN0IGF0dHJzOiB7IFtrZXk6IHN0cmluZ106IHN0cmluZyB9ID0ge307XHJcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGVsZW1lbnQuYXR0cmlidXRlcy5sZW5ndGg7IGkrKykge1xyXG4gICAgICBjb25zdCBhdHRyID0gZWxlbWVudC5hdHRyaWJ1dGVzLml0ZW0oaSk7XHJcbiAgICAgIGlmIChhdHRyKSB7XHJcbiAgICAgICAgYXR0cnNbYXR0ci5uYW1lXSA9IGF0dHIudmFsdWU7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIHZpZXcuZGVzdHJveSgpO1xyXG4gICAgcmV0dXJuIGF0dHJzO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSByZW5kZXJJbmxpbmVXcmFwcGVyKGVkaXRhYmxlOiBzdHJpbmcpIHtcclxuICAgIGNvbnN0IHNwYW46IEhUTUxTcGFuRWxlbWVudCA9IHRoaXMucmVuZGVyZXIuY3JlYXRlRWxlbWVudCgnc3BhbicpO1xyXG4gICAgc3Bhbi5jbGFzc05hbWUgPSAnc2MtaW1hZ2Utd3JhcHBlcic7XHJcbiAgICBzcGFuLmlubmVySFRNTCA9IGVkaXRhYmxlO1xyXG5cclxuICAgIGNvbnN0IHBhcmVudE5vZGUgPSB0aGlzLnJlbmRlcmVyLnBhcmVudE5vZGUodGhpcy5lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQpO1xyXG4gICAgdGhpcy5yZW5kZXJlci5pbnNlcnRCZWZvcmUocGFyZW50Tm9kZSwgc3BhbiwgdGhpcy5lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQpO1xyXG4gICAgcGFyZW50Tm9kZS5yZW1vdmVDaGlsZCh0aGlzLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudCk7XHJcblxyXG4gICAgdGhpcy5pbmxpbmVSZWYgPSBzcGFuO1xyXG4gIH1cclxufVxyXG4iXX0=","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}