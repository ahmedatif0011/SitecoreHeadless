{"ast":null,"code":"import { Directive, Input } from '@angular/core';\nimport { BaseFieldDirective } from './base-field.directive';\nimport { DefaultEmptyFieldEditingComponent } from './default-empty-text-field-editing-placeholder.component';\nimport { MetadataKind } from '@sitecore-jss/sitecore-jss/editing';\nimport * as i0 from \"@angular/core\";\nexport let LinkDirective = /*#__PURE__*/(() => {\n  class LinkDirective extends BaseFieldDirective {\n    templateRef;\n    renderer;\n    elementRef;\n    editable = true;\n    attrs = {};\n    field;\n    /**\n     * Custom template to render in Pages in Metadata edit mode if field value is empty\n     */\n    emptyFieldEditingTemplate;\n    /**\n     * Default component to render in Pages in Metadata edit mode if field value is empty and emptyFieldEditingTemplate is not provided\n     */\n    defaultFieldEditingComponent;\n    inlineRef = null;\n    constructor(viewContainer, templateRef, renderer, elementRef) {\n      super(viewContainer);\n      this.templateRef = templateRef;\n      this.renderer = renderer;\n      this.elementRef = elementRef;\n      this.defaultFieldEditingComponent = DefaultEmptyFieldEditingComponent;\n    }\n    ngOnChanges(changes) {\n      if (changes.field || changes.editable || changes.attrs) {\n        this.viewContainer.clear();\n        if (this.inlineRef) {\n          this.inlineRef.remove();\n          this.inlineRef = null;\n        }\n        this.updateView();\n      }\n    }\n    renderTemplate(props, linkText) {\n      const viewRef = this.viewContainer.createEmbeddedView(this.templateRef);\n      viewRef.rootNodes.forEach(node => {\n        Object.entries(props).forEach(([key, propValue]) => {\n          this.updateAttribute(node, key, propValue);\n        });\n        if (node.childNodes && node.childNodes.length === 0 && linkText) {\n          node.textContent = linkText;\n        }\n      });\n    }\n    updateAttribute(node, key, propValue) {\n      if (typeof propValue !== 'string' || !propValue || propValue === '') {\n        return;\n      }\n      if (key === 'href') {\n        const isInvalidLink = !propValue || /^https?:\\/\\/$/.test(propValue);\n        if (isInvalidLink) {\n          if (!node.href) {\n            return;\n          }\n          propValue = node.href;\n        }\n        this.renderer.setAttribute(node, key, propValue);\n      } else if (key === 'class' && node.className !== '') {\n        this.renderer.setAttribute(node, key, `${node.className} ${propValue}`);\n      } else {\n        this.renderer.setAttribute(node, key, propValue);\n      }\n    }\n    /**\n     * Determines if directive should render the field as is\n     * Returns true if we are in edit mode 'chromes' (field.editable is present) or field is not empty\n     * or link field text is present and we are not in edit mode 'metadata'\n     * The right side of the expression was added to preserve existing functionality\n     */\n    shouldRender() {\n      return super.shouldRender() || !!((this.field?.text || this.field?.value?.text) && !this.field?.metadata);\n    }\n    updateView() {\n      const field = this.field;\n      if (this.editable && field && field.editableFirstPart && field.editableLastPart) {\n        this.renderInlineWrapper(field.editableFirstPart, field.editableLastPart);\n      } else {\n        if (!this.shouldRender()) {\n          super.renderEmpty();\n          return;\n        }\n        const props = field.href ? field : field.value;\n        const linkText = field.text || field.value?.text || field.href || field.value?.href;\n        const anchor = props?.anchor ? `#${props.anchor}` : '';\n        const href = `${props?.href}${anchor}`;\n        const mergedAttrs = {\n          ...props,\n          ...this.attrs,\n          href\n        };\n        delete mergedAttrs.anchor;\n        this.renderMetadata(MetadataKind.Open);\n        this.renderTemplate(mergedAttrs, linkText);\n        this.renderMetadata(MetadataKind.Close);\n      }\n    }\n    renderInlineWrapper(editableFirstPart, editableLastPart) {\n      const span = this.renderer.createElement('span');\n      span.className = 'sc-link-wrapper';\n      span.innerHTML = editableFirstPart + editableLastPart;\n      // assign attributes from template to inline wrapper\n      const attrs = {\n        ...this.getElementAttrs(),\n        ...this.attrs\n      };\n      Object.entries(attrs).forEach(([key, attrValue]) => this.updateAttribute(span, key, attrValue));\n      this.viewContainer.createEmbeddedView(this.templateRef);\n      const parentNode = this.renderer.parentNode(this.elementRef.nativeElement);\n      this.renderer.insertBefore(parentNode, span, this.elementRef.nativeElement);\n      this.inlineRef = span;\n    }\n    getElementAttrs() {\n      const view = this.templateRef.createEmbeddedView(null);\n      const element = view.rootNodes[0];\n      if (!element) {\n        view.destroy();\n        return {};\n      }\n      const attrs = {};\n      for (let i = 0; i < element.attributes.length; i++) {\n        const attr = element.attributes.item(i);\n        if (attr) {\n          attrs[attr.name] = attr.value;\n        }\n      }\n      view.destroy();\n      return attrs;\n    }\n    static ɵfac = function LinkDirective_Factory(t) {\n      return new (t || LinkDirective)(i0.ɵɵdirectiveInject(i0.ViewContainerRef), i0.ɵɵdirectiveInject(i0.TemplateRef), i0.ɵɵdirectiveInject(i0.Renderer2), i0.ɵɵdirectiveInject(i0.ElementRef));\n    };\n    static ɵdir = /* @__PURE__ */i0.ɵɵdefineDirective({\n      type: LinkDirective,\n      selectors: [[\"\", \"scLink\", \"\"]],\n      inputs: {\n        editable: [i0.ɵɵInputFlags.None, \"scLinkEditable\", \"editable\"],\n        attrs: [i0.ɵɵInputFlags.None, \"scLinkAttrs\", \"attrs\"],\n        field: [i0.ɵɵInputFlags.None, \"scLink\", \"field\"],\n        emptyFieldEditingTemplate: [i0.ɵɵInputFlags.None, \"scLinkEmptyFieldEditingTemplate\", \"emptyFieldEditingTemplate\"]\n      },\n      features: [i0.ɵɵInheritDefinitionFeature, i0.ɵɵNgOnChangesFeature]\n    });\n  }\n  return LinkDirective;\n})();\n(() => {\n  (typeof ngDevMode === \"undefined\" || ngDevMode) && void 0;\n})();\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGluay5kaXJlY3RpdmUuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvY29tcG9uZW50cy9saW5rLmRpcmVjdGl2ZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQ0wsU0FBUyxFQUVULEtBQUssR0FPTixNQUFNLGVBQWUsQ0FBQztBQUV2QixPQUFPLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSx3QkFBd0IsQ0FBQztBQUM1RCxPQUFPLEVBQUUsaUNBQWlDLEVBQUUsTUFBTSwwREFBMEQsQ0FBQztBQUM3RyxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0sb0NBQW9DLENBQUM7O0FBR2xFLE1BQU0sT0FBTyxhQUFjLFNBQVEsa0JBQWtCO0lBcUJ2QztJQUNBO0lBQ0Y7SUF0QmUsUUFBUSxHQUFHLElBQUksQ0FBQztJQUVuQixLQUFLLEdBQStCLEVBQUUsQ0FBQztJQUU1QyxLQUFLLENBQVk7SUFFbEM7O09BRUc7SUFDdUMseUJBQXlCLENBQXVCO0lBRTFGOztPQUVHO0lBQ08sNEJBQTRCLENBQWdCO0lBRTlDLFNBQVMsR0FBMkIsSUFBSSxDQUFDO0lBRWpELFlBQ0UsYUFBK0IsRUFDckIsV0FBaUMsRUFDakMsUUFBbUIsRUFDckIsVUFBc0I7UUFFOUIsS0FBSyxDQUFDLGFBQWEsQ0FBQyxDQUFDO1FBSlgsZ0JBQVcsR0FBWCxXQUFXLENBQXNCO1FBQ2pDLGFBQVEsR0FBUixRQUFRLENBQVc7UUFDckIsZUFBVSxHQUFWLFVBQVUsQ0FBWTtRQUc5QixJQUFJLENBQUMsNEJBQTRCLEdBQUcsaUNBQWlDLENBQUM7SUFDeEUsQ0FBQztJQUVELFdBQVcsQ0FBQyxPQUFzQjtRQUNoQyxJQUFJLE9BQU8sQ0FBQyxLQUFLLElBQUksT0FBTyxDQUFDLFFBQVEsSUFBSSxPQUFPLENBQUMsS0FBSyxFQUFFLENBQUM7WUFDdkQsSUFBSSxDQUFDLGFBQWEsQ0FBQyxLQUFLLEVBQUUsQ0FBQztZQUMzQixJQUFJLElBQUksQ0FBQyxT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LENBQUM7UUFDNUMsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLE9BQU8sQ0FBQyxVQUFVLENBQUMsTUFBTSxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUM7WUFDbkQsTUFBTSxJQUFJLEdBQUcsT0FBTyxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDeEMsSUFBSSxJQUFJLEVBQUUsQ0FBQztnQkFDVCxLQUFLLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUM7WUFDaEMsQ0FBQztRQUNILENBQUM7UUFDRCxJQUFJLENBQUMsT0FBTyxFQUFFLENBQUM7UUFDZixPQUFPLEtBQUssQ0FBQztJQUNmLENBQUM7d0dBeEpVLGFBQWE7NEZBQWIsYUFBYTs7NEZBQWIsYUFBYTtrQkFEekIsU0FBUzttQkFBQyxFQUFFLFFBQVEsRUFBRSxVQUFVLEVBQUU7Z0tBRVIsUUFBUTtzQkFBaEMsS0FBSzt1QkFBQyxnQkFBZ0I7Z0JBRUQsS0FBSztzQkFBMUIsS0FBSzt1QkFBQyxhQUFhO2dCQUVILEtBQUs7c0JBQXJCLEtBQUs7dUJBQUMsUUFBUTtnQkFLMkIseUJBQXlCO3NCQUFsRSxLQUFLO3VCQUFDLGlDQUFpQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XHJcbiAgRGlyZWN0aXZlLFxyXG4gIEVsZW1lbnRSZWYsXHJcbiAgSW5wdXQsXHJcbiAgT25DaGFuZ2VzLFxyXG4gIFJlbmRlcmVyMixcclxuICBTaW1wbGVDaGFuZ2VzLFxyXG4gIFRlbXBsYXRlUmVmLFxyXG4gIFR5cGUsXHJcbiAgVmlld0NvbnRhaW5lclJlZixcclxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgTGlua0ZpZWxkIH0gZnJvbSAnLi9yZW5kZXJpbmctZmllbGQnO1xyXG5pbXBvcnQgeyBCYXNlRmllbGREaXJlY3RpdmUgfSBmcm9tICcuL2Jhc2UtZmllbGQuZGlyZWN0aXZlJztcclxuaW1wb3J0IHsgRGVmYXVsdEVtcHR5RmllbGRFZGl0aW5nQ29tcG9uZW50IH0gZnJvbSAnLi9kZWZhdWx0LWVtcHR5LXRleHQtZmllbGQtZWRpdGluZy1wbGFjZWhvbGRlci5jb21wb25lbnQnO1xyXG5pbXBvcnQgeyBNZXRhZGF0YUtpbmQgfSBmcm9tICdAc2l0ZWNvcmUtanNzL3NpdGVjb3JlLWpzcy9lZGl0aW5nJztcclxuXHJcbkBEaXJlY3RpdmUoeyBzZWxlY3RvcjogJ1tzY0xpbmtdJyB9KVxyXG5leHBvcnQgY2xhc3MgTGlua0RpcmVjdGl2ZSBleHRlbmRzIEJhc2VGaWVsZERpcmVjdGl2ZSBpbXBsZW1lbnRzIE9uQ2hhbmdlcyB7XHJcbiAgQElucHV0KCdzY0xpbmtFZGl0YWJsZScpIGVkaXRhYmxlID0gdHJ1ZTtcclxuXHJcbiAgQElucHV0KCdzY0xpbmtBdHRycycpIGF0dHJzOiB7IFthdHRyOiBzdHJpbmddOiBzdHJpbmcgfSA9IHt9O1xyXG5cclxuICBASW5wdXQoJ3NjTGluaycpIGZpZWxkOiBMaW5rRmllbGQ7XHJcblxyXG4gIC8qKlxyXG4gICAqIEN1c3RvbSB0ZW1wbGF0ZSB0byByZW5kZXIgaW4gUGFnZXMgaW4gTWV0YWRhdGEgZWRpdCBtb2RlIGlmIGZpZWxkIHZhbHVlIGlzIGVtcHR5XHJcbiAgICovXHJcbiAgQElucHV0KCdzY0xpbmtFbXB0eUZpZWxkRWRpdGluZ1RlbXBsYXRlJykgZW1wdHlGaWVsZEVkaXRpbmdUZW1wbGF0ZTogVGVtcGxhdGVSZWY8dW5rbm93bj47XHJcblxyXG4gIC8qKlxyXG4gICAqIERlZmF1bHQgY29tcG9uZW50IHRvIHJlbmRlciBpbiBQYWdlcyBpbiBNZXRhZGF0YSBlZGl0IG1vZGUgaWYgZmllbGQgdmFsdWUgaXMgZW1wdHkgYW5kIGVtcHR5RmllbGRFZGl0aW5nVGVtcGxhdGUgaXMgbm90IHByb3ZpZGVkXHJcbiAgICovXHJcbiAgcHJvdGVjdGVkIGRlZmF1bHRGaWVsZEVkaXRpbmdDb21wb25lbnQ6IFR5cGU8dW5rbm93bj47XHJcblxyXG4gIHByaXZhdGUgaW5saW5lUmVmOiBIVE1MU3BhbkVsZW1lbnQgfCBudWxsID0gbnVsbDtcclxuXHJcbiAgY29uc3RydWN0b3IoXHJcbiAgICB2aWV3Q29udGFpbmVyOiBWaWV3Q29udGFpbmVyUmVmLFxyXG4gICAgcHJvdGVjdGVkIHRlbXBsYXRlUmVmOiBUZW1wbGF0ZVJlZjx1bmtub3duPixcclxuICAgIHByb3RlY3RlZCByZW5kZXJlcjogUmVuZGVyZXIyLFxyXG4gICAgcHJpdmF0ZSBlbGVtZW50UmVmOiBFbGVtZW50UmVmXHJcbiAgKSB7XHJcbiAgICBzdXBlcih2aWV3Q29udGFpbmVyKTtcclxuICAgIHRoaXMuZGVmYXVsdEZpZWxkRWRpdGluZ0NvbXBvbmVudCA9IERlZmF1bHRFbXB0eUZpZWxkRWRpdGluZ0NvbXBvbmVudDtcclxuICB9XHJcblxyXG4gIG5nT25DaGFuZ2VzKGNoYW5nZXM6IFNpbXBsZUNoYW5nZXMpIHtcclxuICAgIGlmIChjaGFuZ2VzLmZpZWxkIHx8IGNoYW5nZXMuZWRpdGFibGUgfHwgY2hhbmdlcy5hdHRycykge1xyXG4gICAgICB0aGlzLnZpZXdDb250YWluZXIuY2xlYXIoKTtcclxuICAgICAgaWYgKHRoaXMuaW5saW5lUmVmKSB7XHJcbiAgICAgICAgdGhpcy5pbmxpbmVSZWYucmVtb3ZlKCk7XHJcbiAgICAgICAgdGhpcy5pbmxpbmVSZWYgPSBudWxsO1xyXG4gICAgICB9XHJcblxyXG4gICAgICB0aGlzLnVwZGF0ZVZpZXcoKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHByb3RlY3RlZCByZW5kZXJUZW1wbGF0ZShwcm9wczogeyBbcHJvcDogc3RyaW5nXTogdW5rbm93biB9LCBsaW5rVGV4dD86IHN0cmluZykge1xyXG4gICAgY29uc3Qgdmlld1JlZiA9IHRoaXMudmlld0NvbnRhaW5lci5jcmVhdGVFbWJlZGRlZFZpZXcodGhpcy50ZW1wbGF0ZVJlZik7XHJcblxyXG4gICAgdmlld1JlZi5yb290Tm9kZXMuZm9yRWFjaCgobm9kZSkgPT4ge1xyXG4gICAgICBPYmplY3QuZW50cmllcyhwcm9wcykuZm9yRWFjaCgoW2tleSwgcHJvcFZhbHVlXSkgPT4ge1xyXG4gICAgICAgIHRoaXMudXBkYXRlQXR0cmlidXRlKG5vZGUsIGtleSwgcHJvcFZhbHVlKTtcclxuICAgICAgfSk7XHJcblxyXG4gICAgICBpZiAobm9kZS5jaGlsZE5vZGVzICYmIG5vZGUuY2hpbGROb2Rlcy5sZW5ndGggPT09IDAgJiYgbGlua1RleHQpIHtcclxuICAgICAgICBub2RlLnRleHRDb250ZW50ID0gbGlua1RleHQ7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgcHJvdGVjdGVkIHVwZGF0ZUF0dHJpYnV0ZShub2RlOiBIVE1MRWxlbWVudCwga2V5OiBzdHJpbmcsIHByb3BWYWx1ZT86IHVua25vd24pIHtcclxuICAgIGlmICh0eXBlb2YgcHJvcFZhbHVlICE9PSAnc3RyaW5nJyB8fCAhcHJvcFZhbHVlIHx8IHByb3BWYWx1ZSA9PT0gJycpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIGlmIChrZXkgPT09ICdocmVmJykge1xyXG4gICAgICBjb25zdCBpc0ludmFsaWRMaW5rID0gIXByb3BWYWx1ZSB8fCAvXmh0dHBzPzpcXC9cXC8kLy50ZXN0KHByb3BWYWx1ZSk7XHJcblxyXG4gICAgICBpZiAoaXNJbnZhbGlkTGluaykge1xyXG4gICAgICAgIGlmICghKG5vZGUgYXMgSFRNTExpbmtFbGVtZW50KS5ocmVmKSB7XHJcbiAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwcm9wVmFsdWUgPSAobm9kZSBhcyBIVE1MTGlua0VsZW1lbnQpLmhyZWYgYXMgc3RyaW5nO1xyXG4gICAgICB9XHJcbiAgICAgIHRoaXMucmVuZGVyZXIuc2V0QXR0cmlidXRlKG5vZGUsIGtleSwgcHJvcFZhbHVlIGFzIHN0cmluZyk7XHJcbiAgICB9IGVsc2UgaWYgKGtleSA9PT0gJ2NsYXNzJyAmJiBub2RlLmNsYXNzTmFtZSAhPT0gJycpIHtcclxuICAgICAgdGhpcy5yZW5kZXJlci5zZXRBdHRyaWJ1dGUobm9kZSwga2V5LCBgJHtub2RlLmNsYXNzTmFtZX0gJHtwcm9wVmFsdWV9YCk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aGlzLnJlbmRlcmVyLnNldEF0dHJpYnV0ZShub2RlLCBrZXksIHByb3BWYWx1ZSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBEZXRlcm1pbmVzIGlmIGRpcmVjdGl2ZSBzaG91bGQgcmVuZGVyIHRoZSBmaWVsZCBhcyBpc1xyXG4gICAqIFJldHVybnMgdHJ1ZSBpZiB3ZSBhcmUgaW4gZWRpdCBtb2RlICdjaHJvbWVzJyAoZmllbGQuZWRpdGFibGUgaXMgcHJlc2VudCkgb3IgZmllbGQgaXMgbm90IGVtcHR5XHJcbiAgICogb3IgbGluayBmaWVsZCB0ZXh0IGlzIHByZXNlbnQgYW5kIHdlIGFyZSBub3QgaW4gZWRpdCBtb2RlICdtZXRhZGF0YSdcclxuICAgKiBUaGUgcmlnaHQgc2lkZSBvZiB0aGUgZXhwcmVzc2lvbiB3YXMgYWRkZWQgdG8gcHJlc2VydmUgZXhpc3RpbmcgZnVuY3Rpb25hbGl0eVxyXG4gICAqL1xyXG4gIHByb3RlY3RlZCBzaG91bGRSZW5kZXIoKSB7XHJcbiAgICByZXR1cm4gKFxyXG4gICAgICBzdXBlci5zaG91bGRSZW5kZXIoKSB8fFxyXG4gICAgICAhISgodGhpcy5maWVsZD8udGV4dCB8fCB0aGlzLmZpZWxkPy52YWx1ZT8udGV4dCkgJiYgIXRoaXMuZmllbGQ/Lm1ldGFkYXRhKVxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgdXBkYXRlVmlldygpIHtcclxuICAgIGNvbnN0IGZpZWxkID0gdGhpcy5maWVsZDtcclxuICAgIGlmICh0aGlzLmVkaXRhYmxlICYmIGZpZWxkICYmIGZpZWxkLmVkaXRhYmxlRmlyc3RQYXJ0ICYmIGZpZWxkLmVkaXRhYmxlTGFzdFBhcnQpIHtcclxuICAgICAgdGhpcy5yZW5kZXJJbmxpbmVXcmFwcGVyKGZpZWxkLmVkaXRhYmxlRmlyc3RQYXJ0LCBmaWVsZC5lZGl0YWJsZUxhc3RQYXJ0KTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGlmICghdGhpcy5zaG91bGRSZW5kZXIoKSkge1xyXG4gICAgICAgIHN1cGVyLnJlbmRlckVtcHR5KCk7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBjb25zdCBwcm9wcyA9IGZpZWxkLmhyZWYgPyBmaWVsZCA6IGZpZWxkLnZhbHVlO1xyXG5cclxuICAgICAgY29uc3QgbGlua1RleHQgPSBmaWVsZC50ZXh0IHx8IGZpZWxkLnZhbHVlPy50ZXh0IHx8IGZpZWxkLmhyZWYgfHwgZmllbGQudmFsdWU/LmhyZWY7XHJcbiAgICAgIGNvbnN0IGFuY2hvciA9IHByb3BzPy5hbmNob3IgPyBgIyR7cHJvcHMuYW5jaG9yfWAgOiAnJztcclxuICAgICAgY29uc3QgaHJlZiA9IGAke3Byb3BzPy5ocmVmfSR7YW5jaG9yfWA7XHJcblxyXG4gICAgICBjb25zdCBtZXJnZWRBdHRycyA9IHsgLi4ucHJvcHMsIC4uLnRoaXMuYXR0cnMsIGhyZWYgfTtcclxuXHJcbiAgICAgIGRlbGV0ZSBtZXJnZWRBdHRycy5hbmNob3I7XHJcbiAgICAgIHRoaXMucmVuZGVyTWV0YWRhdGEoTWV0YWRhdGFLaW5kLk9wZW4pO1xyXG4gICAgICB0aGlzLnJlbmRlclRlbXBsYXRlKG1lcmdlZEF0dHJzLCBsaW5rVGV4dCk7XHJcbiAgICAgIHRoaXMucmVuZGVyTWV0YWRhdGEoTWV0YWRhdGFLaW5kLkNsb3NlKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHByaXZhdGUgcmVuZGVySW5saW5lV3JhcHBlcihlZGl0YWJsZUZpcnN0UGFydDogc3RyaW5nLCBlZGl0YWJsZUxhc3RQYXJ0OiBzdHJpbmcpIHtcclxuICAgIGNvbnN0IHNwYW46IEhUTUxTcGFuRWxlbWVudCA9IHRoaXMucmVuZGVyZXIuY3JlYXRlRWxlbWVudCgnc3BhbicpO1xyXG4gICAgc3Bhbi5jbGFzc05hbWUgPSAnc2MtbGluay13cmFwcGVyJztcclxuICAgIHNwYW4uaW5uZXJIVE1MID0gZWRpdGFibGVGaXJzdFBhcnQgKyBlZGl0YWJsZUxhc3RQYXJ0O1xyXG5cclxuICAgIC8vIGFzc2lnbiBhdHRyaWJ1dGVzIGZyb20gdGVtcGxhdGUgdG8gaW5saW5lIHdyYXBwZXJcclxuICAgIGNvbnN0IGF0dHJzID0ge1xyXG4gICAgICAuLi50aGlzLmdldEVsZW1lbnRBdHRycygpLFxyXG4gICAgICAuLi50aGlzLmF0dHJzLFxyXG4gICAgfTtcclxuICAgIE9iamVjdC5lbnRyaWVzKGF0dHJzKS5mb3JFYWNoKChba2V5LCBhdHRyVmFsdWVdKSA9PiB0aGlzLnVwZGF0ZUF0dHJpYnV0ZShzcGFuLCBrZXksIGF0dHJWYWx1ZSkpO1xyXG5cclxuICAgIHRoaXMudmlld0NvbnRhaW5lci5jcmVhdGVFbWJlZGRlZFZpZXcodGhpcy50ZW1wbGF0ZVJlZik7XHJcblxyXG4gICAgY29uc3QgcGFyZW50Tm9kZSA9IHRoaXMucmVuZGVyZXIucGFyZW50Tm9kZSh0aGlzLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudCk7XHJcbiAgICB0aGlzLnJlbmRlcmVyLmluc2VydEJlZm9yZShwYXJlbnROb2RlLCBzcGFuLCB0aGlzLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudCk7XHJcblxyXG4gICAgdGhpcy5pbmxpbmVSZWYgPSBzcGFuO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBnZXRFbGVtZW50QXR0cnMoKSB7XHJcbiAgICBjb25zdCB2aWV3ID0gdGhpcy50ZW1wbGF0ZVJlZi5jcmVhdGVFbWJlZGRlZFZpZXcobnVsbCk7XHJcbiAgICBjb25zdCBlbGVtZW50OiBFbGVtZW50ID0gdmlldy5yb290Tm9kZXNbMF07XHJcbiAgICBpZiAoIWVsZW1lbnQpIHtcclxuICAgICAgdmlldy5kZXN0cm95KCk7XHJcbiAgICAgIHJldHVybiB7fTtcclxuICAgIH1cclxuICAgIGNvbnN0IGF0dHJzOiB7IFtrZXk6IHN0cmluZ106IHN0cmluZyB9ID0ge307XHJcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGVsZW1lbnQuYXR0cmlidXRlcy5sZW5ndGg7IGkrKykge1xyXG4gICAgICBjb25zdCBhdHRyID0gZWxlbWVudC5hdHRyaWJ1dGVzLml0ZW0oaSk7XHJcbiAgICAgIGlmIChhdHRyKSB7XHJcbiAgICAgICAgYXR0cnNbYXR0ci5uYW1lXSA9IGF0dHIudmFsdWU7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIHZpZXcuZGVzdHJveSgpO1xyXG4gICAgcmV0dXJuIGF0dHJzO1xyXG4gIH1cclxufVxyXG4iXX0=","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}